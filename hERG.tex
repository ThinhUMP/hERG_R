% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\author{}
\date{\vspace{-2.5em}}

\begin{document}

\begin{center}
  \vspace*{-2cm} % move logo up
  \includegraphics[width=4cm]{figs/upc_logo.png}\\[1em] % <-- logo size and spacing
  {
    \LARGE \textbf{Chemoinformatic project} \\
      \textbf{M1- ISDD}
  } \\[0.5em]
  Student name: Van Thinh TO \\
  Student ID: 22518830
\end{center}

\section{Preparation of data and computation of molecule
similarity}\label{preparation-of-data-and-computation-of-molecule-similarity}

\subsection{Analysis of the data set}\label{analysis-of-the-data-set}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load the necessary package}
\FunctionTok{library}\NormalTok{(ChemmineR)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load data set}
\NormalTok{training\_data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"data/training\_data.csv"}\NormalTok{, }\AttributeTok{sep=}\StringTok{","}\NormalTok{)}
\FunctionTok{dim}\NormalTok{(training\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 224945      5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(training\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "SID"       "partition" "activity"  "potency"   "smiles"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(training\_data}\SpecialCharTok{$}\NormalTok{activity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##   Active Inactive 
##     1453   223492
\end{verbatim}

How many molecules are included in the data set? How many are Active and
how many are Inactive? There are 224945 molecules in the data set, which
have 1453 active and 223492 inactive data points.

What information is provided in each column? What is the data type of
each variable? There are five columns in the data set:

\begin{itemize}
\tightlist
\item
  \textbf{SID}: unique identifier for each molecule \emph{(integer)}
\item
  \textbf{partition}: indicates Training or Test set \emph{(character)}
\item
  \textbf{activity}: biological class (Active / Inactive)
  \emph{(character)}
\item
  \textbf{potency}: numerical activity value, e.g., --log(IC50)
  \emph{(numeric)}
\item
  \textbf{smiles}: SMILES string representing each molecule
  \emph{(character)}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(training\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    224945 obs. of  5 variables:
##  $ SID      : int  405266972 405266969 405258654 405266973 405266971 439657910 440228774 381749740 405266954 381749741 ...
##  $ partition: chr  "Training" "Training" "Training" "Training" ...
##  $ activity : chr  "Active" "Active" "Active" "Active" ...
##  $ potency  : num  9.3 9.3 9.3 9.3 9.22 ...
##  $ smiles   : chr  "C1=CC(=C(C=C1N2C=C(N=N2)CN3C=CN=C3N)C(F)F)F" "C1=CC(=C(C=C1N2C=C(N=N2)CN3C=CN=C3N)OC(F)F)Cl" "CC(C1=C(C=CC(=C1)N2C=C(N=N2)CN3C=CN=C3N)Cl)(F)F" "CC(C1=C(C=CC(=C1)N2C=C(N=N2)CN3C=CN=C3N)F)(F)F" ...
\end{verbatim}

Check whether the data set contains any missing values (NA). If this is
the case, remove all molecules with missing entries. How many molecules
are removed?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get nan data points}
\CommentTok{\# which(is.na(training\_data), arr.ind = TRUE)}
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(training\_data))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 223157
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get nan values for each column}
\FunctionTok{sapply}\NormalTok{(training\_data, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(x)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       SID partition  activity   potency    smiles 
##         0         0         0    223157         0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# drop rows with nan value}
\NormalTok{training\_data }\OtherTok{\textless{}{-}} \FunctionTok{na.omit}\NormalTok{(training\_data)}
\FunctionTok{dim}\NormalTok{(training\_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1788    5
\end{verbatim}

\subsection{Exploring the Chemical Space and Computing Molecular
Similarity}\label{exploring-the-chemical-space-and-computing-molecular-similarity}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create data set for the sdf conversion}
\NormalTok{herg }\OtherTok{\textless{}{-}}\NormalTok{ training\_data[}\FunctionTok{c}\NormalTok{(}\StringTok{"smiles"}\NormalTok{, }\StringTok{"SID"}\NormalTok{)]}
\FunctionTok{write.table}\NormalTok{(herg, }\StringTok{"data/herg.smi"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{, }\AttributeTok{quote =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{col.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# read sdf file after creation}
\NormalTok{sdf\_df }\OtherTok{\textless{}{-}} \FunctionTok{read.SDFset}\NormalTok{(}\StringTok{"data/herg.sdf"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# compute the AP fingerprints}
\NormalTok{ap }\OtherTok{\textless{}{-}} \FunctionTok{sdf2ap}\NormalTok{(sdf\_df)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# \# compute the similarity matrix}
\CommentTok{\# simi\_matrix = matrix(0, nrow=length(ap),ncol=length(ap))}
\CommentTok{\# for (i in 1:length(ap))\{}
\CommentTok{\#   for (j in i:length(ap))\{}
\CommentTok{\#     simi\_ij \textless{}{-} cmp.similarity(ap[i], ap[j])}
\CommentTok{\#     simi\_matrix[i, j] \textless{}{-} simi\_ij}
\CommentTok{\#     simi\_matrix[j, i] \textless{}{-} simi\_ij}
\CommentTok{\#   \}}
\CommentTok{\# \}}
\CommentTok{\# }
\CommentTok{\# \# save similarity matrix for the later usage}
\CommentTok{\# save(simi\_matrix, file="data/simi\_matrix.RData")}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load the similarity matrix}
\FunctionTok{load}\NormalTok{(}\StringTok{"data/simi\_matrix.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# compute the dissimilarity matrix}
\NormalTok{dissimi\_matrix }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{{-}}\NormalTok{simi\_matrix}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# perform MDs}
\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{cmdscale}\NormalTok{(dissimi\_matrix)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Visualization MDs}
\CommentTok{\# load ggplot}
\FunctionTok{library}\NormalTok{(ggplot2)}

\NormalTok{vis\_mds }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(mds, df, group\_col)\{}
  \CommentTok{\# create data frame for visualization}
\NormalTok{  df\_mds }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{x =}\NormalTok{ mds[,}\DecValTok{1}\NormalTok{],}
    \AttributeTok{y =}\NormalTok{ mds[,}\DecValTok{2}\NormalTok{],}
    \AttributeTok{color =}\NormalTok{ df[,group\_col]}
\NormalTok{  )}
  
  \CommentTok{\# plot}
  \FunctionTok{ggplot}\NormalTok{(df\_mds, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{color =}\NormalTok{ color)) }\SpecialCharTok{+}
    \CommentTok{\# scatter plot}
    \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{labs}\NormalTok{(}
      \AttributeTok{x =} \StringTok{"MDS dimension 1"}\NormalTok{,}
      \AttributeTok{y =} \StringTok{"MDS dimension 2"}\NormalTok{,}
      \AttributeTok{color =}\NormalTok{ group\_col}
\NormalTok{    ) }\SpecialCharTok{+}
    \CommentTok{\# set theme}
    \FunctionTok{theme\_minimal}\NormalTok{()}
\NormalTok{\}}

\FunctionTok{vis\_mds}\NormalTok{(}\AttributeTok{mds=}\NormalTok{mds, }\AttributeTok{df=}\NormalTok{training\_data, }\AttributeTok{group\_col=}\StringTok{"activity"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{hERG_files/figure-latex/unnamed-chunk-16-1.pdf}}

We can observe that the molecule are widely dispersed. However, there is
a huge overlap between active and inactive data points.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(training\_data}\SpecialCharTok{$}\NormalTok{activity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##   Active Inactive 
##     1453      335
\end{verbatim}

\section{Balancing the dataset and preparing training and test
sets}\label{balancing-the-dataset-and-preparing-training-and-test-sets}

\subsection{Cluster-based undersampling
method}\label{cluster-based-undersampling-method}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Extract active molecules}
\NormalTok{active\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(training\_data}\SpecialCharTok{$}\NormalTok{activity}\SpecialCharTok{==} \StringTok{"Active"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Calculate the dissimilarity matrix for actives only}
\NormalTok{dissimi\_act\_rep }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{{-}}\NormalTok{ simi\_matrix[active\_idx, active\_idx]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Perform hierarchical clustering}
\NormalTok{hc }\OtherTok{\textless{}{-}} \FunctionTok{hclust}\NormalTok{(}\FunctionTok{dist}\NormalTok{(dissimi\_act\_rep), }\AttributeTok{method =} \StringTok{"ward.D2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Cut the dendrogram into 350 clusters}
\NormalTok{active\_groups }\OtherTok{\textless{}{-}} \FunctionTok{cutree}\NormalTok{(hc, }\AttributeTok{k=}\DecValTok{350}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# plot the clusters}
\FunctionTok{plot}\NormalTok{(hc)}
\FunctionTok{rect.hclust}\NormalTok{(hc , }\AttributeTok{k =} \DecValTok{350}\NormalTok{, }\AttributeTok{border =} \DecValTok{2}\SpecialCharTok{:}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{hERG_files/figure-latex/unnamed-chunk-22-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# pdf("figs/comp\_cluster.pdf", width = 10, height = 6)}
\CommentTok{\# to see how many compounds each group has}
\NormalTok{table\_group }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(active\_groups)}
\FunctionTok{barplot}\NormalTok{(table\_group, }\AttributeTok{col =} \FunctionTok{rainbow}\NormalTok{(}\FunctionTok{length}\NormalTok{(table\_group)),)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{hERG_files/figure-latex/unnamed-chunk-23-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# dev.off()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select one molecule per cluster}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{20022001}\NormalTok{) }\CommentTok{\# seed for reproduction}
\NormalTok{selected\_active\_idx }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (group }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{350}\NormalTok{)\{}
  \CommentTok{\# for each group, randomly choose one active molecule, then append to a vector}
\NormalTok{  selected\_active\_idx }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(selected\_active\_idx, }\FunctionTok{sample}\NormalTok{(}\FunctionTok{which}\NormalTok{(active\_groups}\SpecialCharTok{==}\NormalTok{group), }\AttributeTok{size=}\DecValTok{1}\NormalTok{))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create a balanced data set}
\CommentTok{\# select inactive}
\NormalTok{inactive\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(training\_data}\SpecialCharTok{$}\NormalTok{activity}\SpecialCharTok{==} \StringTok{"Inactive"}\NormalTok{)}
\CommentTok{\# concate inactive and selected active}
\NormalTok{balanced\_df }\OtherTok{\textless{}{-}}\NormalTok{ training\_data[}\FunctionTok{c}\NormalTok{(selected\_active\_idx, inactive\_idx),]}
\FunctionTok{dim}\NormalTok{(balanced\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 685   5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create data frame for visualization}
\NormalTok{mds\_selected }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \CommentTok{\# select mds coordinations for the balanced data set}
  \AttributeTok{x =}\NormalTok{ mds[}\FunctionTok{c}\NormalTok{(selected\_active\_idx, inactive\_idx),}\DecValTok{1}\NormalTok{],}
  \AttributeTok{y =}\NormalTok{ mds[}\FunctionTok{c}\NormalTok{(selected\_active\_idx, inactive\_idx),}\DecValTok{2}\NormalTok{],}
  \AttributeTok{activity =}\NormalTok{ balanced\_df}\SpecialCharTok{$}\NormalTok{activity}
\NormalTok{)}

\FunctionTok{vis\_mds}\NormalTok{(}\AttributeTok{mds=}\NormalTok{mds\_selected, }\AttributeTok{df=}\NormalTok{balanced\_df, }\AttributeTok{group\_col=}\StringTok{"activity"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{hERG_files/figure-latex/unnamed-chunk-26-1.pdf}}

According to the Figure above, the cluster-based undersampling method
avoids redundancy, preserves chemical diversity, and produces a balanced
dataset suitable for building robust predictive models.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# save the balanced data set}
\FunctionTok{save}\NormalTok{(balanced\_df, }\AttributeTok{file =} \StringTok{"data/balanced\_df.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{Preparing training and test
set}\label{preparing-training-and-test-set}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{20022001}\NormalTok{)}
\CommentTok{\# randomly select 80\% of molecules from the balanced data set}
\NormalTok{training\_idx }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(balanced\_df), }\AttributeTok{size =} \DecValTok{8}\SpecialCharTok{/}\DecValTok{10} \SpecialCharTok{*} \FunctionTok{nrow}\NormalTok{(balanced\_df))}
\CommentTok{\# get the training and test sets}
\NormalTok{training\_df }\OtherTok{\textless{}{-}}\NormalTok{ balanced\_df[training\_idx,]}
\NormalTok{test\_df }\OtherTok{\textless{}{-}}\NormalTok{ balanced\_df[}\SpecialCharTok{{-}}\NormalTok{training\_idx,]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check the data points for each partition}
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(balanced\_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 685   5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(training\_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 548   5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(test\_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 137   5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a new variable to indicate whether each molecule belongs to the training or the test set}
\NormalTok{balanced\_df[}\SpecialCharTok{{-}}\NormalTok{training\_idx,}\StringTok{"partition"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Test"}
\FunctionTok{table}\NormalTok{(balanced\_df}\SpecialCharTok{$}\NormalTok{partition)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##     Test Training 
##      137      548
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check the distribution of Active and Inactive molecules in the training set}
\FunctionTok{table}\NormalTok{(training\_df}\SpecialCharTok{$}\NormalTok{activity)}\SpecialCharTok{/}\FunctionTok{nrow}\NormalTok{(training\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##    Active  Inactive 
## 0.5054745 0.4945255
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check the distribution of Active and Inactive molecules in the test set}
\FunctionTok{table}\NormalTok{(test\_df}\SpecialCharTok{$}\NormalTok{activity)}\SpecialCharTok{/}\FunctionTok{nrow}\NormalTok{(test\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##    Active  Inactive 
## 0.5328467 0.4671533
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{vis\_mds}\NormalTok{(}\AttributeTok{mds=}\NormalTok{mds\_selected, }\AttributeTok{df=}\NormalTok{balanced\_df, }\AttributeTok{group\_col=}\StringTok{"partition"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{hERG_files/figure-latex/unnamed-chunk-35-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# save the training and test sets}
\FunctionTok{save}\NormalTok{(training\_df, }\AttributeTok{file =} \StringTok{"data/training.RData"}\NormalTok{)}
\FunctionTok{save}\NormalTok{(test\_df, }\AttributeTok{file =} \StringTok{"data/test.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Prediction of molecule class (Active/Inactive) Using a k-NN
Approach based on chemical
similarity}\label{prediction-of-molecule-class-activeinactive-using-a-k-nn-approach-based-on-chemical-similarity}

\subsection{First steps with the k-NN
algorithm}\label{first-steps-with-the-k-nn-algorithm}

\subsubsection{Manual computation}\label{manual-computation}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Extract the training–training submatrix}
\CommentTok{\# get training–training indices}
\NormalTok{training\_idx }\OtherTok{\textless{}{-}} \FunctionTok{strtoi}\NormalTok{(}\FunctionTok{row.names}\NormalTok{(training\_df))}
\CommentTok{\# get submatrix}
\NormalTok{training\_simi\_matrix }\OtherTok{\textless{}{-}}\NormalTok{ simi\_matrix[training\_idx, training\_idx]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Assign NA to the diagonal of this submatrix}
\FunctionTok{diag}\NormalTok{(training\_simi\_matrix) }\OtherTok{=} \ConstantTok{NA}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get the index of three molecules, which have the highest similarity compared to molecule 5}
\NormalTok{man\_idx }\OtherTok{\textless{}{-}} \FunctionTok{order}\NormalTok{(training\_simi\_matrix[}\DecValTok{5}\NormalTok{,], }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Identify the activity classes of the 3 neighbors of molecule 5}
\NormalTok{votes }\OtherTok{\textless{}{-}}\NormalTok{ training\_df}\SpecialCharTok{$}\NormalTok{activity[man\_idx]}
\NormalTok{votes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Inactive" "Inactive" "Inactive"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Determine the majority class}
\FunctionTok{names}\NormalTok{(}\FunctionTok{which.max}\NormalTok{(}\FunctionTok{table}\NormalTok{(votes)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Inactive"
\end{verbatim}

\subsubsection{Building a k-NN model on the training
set}\label{building-a-k-nn-model-on-the-training-set}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# function for training the knn model}
\NormalTok{knn\_train }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(train, simi\_matrix, k)\{}
\NormalTok{  pred }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(train))\{}
    \CommentTok{\# get the indices of k neighbors}
\NormalTok{    neighbor\_idx }\OtherTok{\textless{}{-}} \FunctionTok{order}\NormalTok{(simi\_matrix[i,], }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{k]}
    \CommentTok{\# majority voting}
\NormalTok{    votes }\OtherTok{\textless{}{-}}\NormalTok{ train}\SpecialCharTok{$}\NormalTok{activity[neighbor\_idx]}
\NormalTok{    pred\_label }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{which.max}\NormalTok{(}\FunctionTok{table}\NormalTok{(votes)))}
    \CommentTok{\# update the label of the prediction vector}
\NormalTok{    pred }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pred, pred\_label)}
\NormalTok{  \}}
  \CommentTok{\# compute the confusion matrix}
\NormalTok{  confusion\_matrix }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\AttributeTok{True =}\NormalTok{ train}\SpecialCharTok{$}\NormalTok{activity, }\AttributeTok{Predicted =}\NormalTok{ pred)}
  
  \FunctionTok{return}\NormalTok{ (confusion\_matrix)}
\NormalTok{\}}

\CommentTok{\# function for evaluating the knn model}
\NormalTok{knn\_eval }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(train, test, simi\_matrix, k)\{}
\NormalTok{  pred }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(test))\{}
    \CommentTok{\# get the indices of k neighbors}
\NormalTok{    neighbor\_idx }\OtherTok{\textless{}{-}} \FunctionTok{order}\NormalTok{(simi\_matrix[i,], }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{k]}
    \CommentTok{\# majority voting}
\NormalTok{    votes }\OtherTok{\textless{}{-}}\NormalTok{ train}\SpecialCharTok{$}\NormalTok{activity[neighbor\_idx]}
\NormalTok{    pred\_label }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{which.max}\NormalTok{(}\FunctionTok{table}\NormalTok{(votes)))}
    \CommentTok{\# update the label of the prediction vector}
\NormalTok{    pred }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pred, pred\_label)}
\NormalTok{  \}}
  \CommentTok{\# compute the confusion matrix}
\NormalTok{  confusion\_matrix }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\AttributeTok{True =}\NormalTok{ test}\SpecialCharTok{$}\NormalTok{activity, }\AttributeTok{Predicted =}\NormalTok{ pred)}
  
  \FunctionTok{return}\NormalTok{ (confusion\_matrix)}
\NormalTok{\}}

\CommentTok{\# function to extract classification metrics}
\NormalTok{class\_metrics }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(confusion\_matrix)\{}
  \CommentTok{\# extract TP, FN, FP, TN values}
\NormalTok{  TP }\OtherTok{\textless{}{-}}\NormalTok{ confusion\_matrix[}\StringTok{"Active"}\NormalTok{, }\StringTok{"Active"}\NormalTok{]}
\NormalTok{  FN }\OtherTok{\textless{}{-}}\NormalTok{ confusion\_matrix[}\StringTok{"Active"}\NormalTok{, }\StringTok{"Inactive"}\NormalTok{]}
\NormalTok{  FP }\OtherTok{\textless{}{-}}\NormalTok{ confusion\_matrix[}\StringTok{"Inactive"}\NormalTok{, }\StringTok{"Active"}\NormalTok{]}
\NormalTok{  TN }\OtherTok{\textless{}{-}}\NormalTok{ confusion\_matrix[}\StringTok{"Inactive"}\NormalTok{, }\StringTok{"Inactive"}\NormalTok{]}
  
  \CommentTok{\# calculate metrics}
\NormalTok{  accuracy }\OtherTok{\textless{}{-}}\NormalTok{ (TP }\SpecialCharTok{+}\NormalTok{ TN) }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(confusion\_matrix)}
\NormalTok{  recall }\OtherTok{\textless{}{-}}\NormalTok{ TP }\SpecialCharTok{/}\NormalTok{ (TP }\SpecialCharTok{+}\NormalTok{ FN)}
\NormalTok{  precision }\OtherTok{\textless{}{-}}\NormalTok{ TP }\SpecialCharTok{/}\NormalTok{ (TP }\SpecialCharTok{+}\NormalTok{ FP)}
\NormalTok{  specificity }\OtherTok{\textless{}{-}}\NormalTok{ TN }\SpecialCharTok{/}\NormalTok{ (TN }\SpecialCharTok{+}\NormalTok{ FP)}
\NormalTok{  balance\_accuracy }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(recall, specificity)}
\NormalTok{  f1\_score }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{2} \SpecialCharTok{*}\NormalTok{ recall }\SpecialCharTok{*}\NormalTok{ precision)}\SpecialCharTok{/}\NormalTok{(recall }\SpecialCharTok{+}\NormalTok{ precision)}
  
  \FunctionTok{return}\NormalTok{ (}
    \FunctionTok{list}\NormalTok{(}
      \AttributeTok{accuracy=}\NormalTok{accuracy,}
      \AttributeTok{recall=}\NormalTok{recall,}
      \AttributeTok{precision=}\NormalTok{precision,}
      \AttributeTok{specificity=}\NormalTok{specificity,}
      \AttributeTok{balance\_accuracy =}\NormalTok{ balance\_accuracy,}
      \AttributeTok{f1\_score =}\NormalTok{ f1\_score}
\NormalTok{    )}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{Implementing the k-NN model: selection of the optimal number
of neighbors with
cross-validation}\label{implementing-the-k-nn-model-selection-of-the-optimal-number-of-neighbors-with-cross-validation}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{20022001}\NormalTok{)}

\NormalTok{cross\_validation }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, simi\_matrix, K\_folds)\{}
  \CommentTok{\# create 1{-}10 vectors and then randomly change their positions}
\NormalTok{  fold\_id }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{K\_folds, }\AttributeTok{length.out =} \FunctionTok{nrow}\NormalTok{(df)))}
  
\NormalTok{  k\_values }\OtherTok{\textless{}{-}} \DecValTok{2}\SpecialCharTok{:}\DecValTok{20}
  
  \CommentTok{\# to store per{-}fold metrics}
\NormalTok{  cv\_raw }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{()}
  
  \ControlFlowTok{for}\NormalTok{ (k }\ControlFlowTok{in}\NormalTok{ k\_values) \{}
    \ControlFlowTok{for}\NormalTok{ (fold }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{K\_folds) \{}
      \CommentTok{\# get train and valid indices for this fold}
\NormalTok{      valid\_idx\_local }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(fold\_id }\SpecialCharTok{==}\NormalTok{ fold)}
\NormalTok{      train\_idx\_local }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(fold\_id }\SpecialCharTok{!=}\NormalTok{ fold)}
      
      \CommentTok{\# split data}
\NormalTok{      train\_df\_cv }\OtherTok{\textless{}{-}}\NormalTok{ df[train\_idx\_local, ]}
\NormalTok{      valid\_df\_cv }\OtherTok{\textless{}{-}}\NormalTok{ df[valid\_idx\_local, ]}
      
      \CommentTok{\# map to global indices to get subsimilarity matrix}
\NormalTok{      train\_row\_idx }\OtherTok{\textless{}{-}} \FunctionTok{strtoi}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(train\_df\_cv))}
\NormalTok{      valid\_row\_idx }\OtherTok{\textless{}{-}} \FunctionTok{strtoi}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(valid\_df\_cv))}
      
      \CommentTok{\# similarity matrices for this fold}
\NormalTok{      train\_simi\_matrix }\OtherTok{\textless{}{-}}\NormalTok{ simi\_matrix[train\_row\_idx, train\_row\_idx]}
      \FunctionTok{diag}\NormalTok{(train\_simi\_matrix) }\OtherTok{\textless{}{-}} \ConstantTok{NA}  \CommentTok{\# can not be neighbored by themselves}
      
      \CommentTok{\# always get similarity between valid and train data points}
\NormalTok{      valid\_simi\_matrix }\OtherTok{\textless{}{-}}\NormalTok{ simi\_matrix[valid\_row\_idx, train\_row\_idx]}
      
      \CommentTok{\# evaluate on validation fold}
\NormalTok{      conf\_mat }\OtherTok{\textless{}{-}} \FunctionTok{knn\_eval}\NormalTok{(}
        \AttributeTok{train =}\NormalTok{ train\_df\_cv,}
        \AttributeTok{test  =}\NormalTok{ valid\_df\_cv,}
        \AttributeTok{simi\_matrix =}\NormalTok{ valid\_simi\_matrix,}
        \AttributeTok{k =}\NormalTok{ k}
\NormalTok{      )}
      
\NormalTok{      metrics }\OtherTok{\textless{}{-}} \FunctionTok{class\_metrics}\NormalTok{(conf\_mat)}
      
      \CommentTok{\# save this fold result}
\NormalTok{      cv\_raw }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}
\NormalTok{        cv\_raw,}
        \FunctionTok{data.frame}\NormalTok{(}
          \AttributeTok{k =}\NormalTok{ k,}
          \AttributeTok{fold =}\NormalTok{ fold,}
          \AttributeTok{accuracy =}\NormalTok{ metrics}\SpecialCharTok{$}\NormalTok{accuracy,}
          \AttributeTok{recall =}\NormalTok{ metrics}\SpecialCharTok{$}\NormalTok{recall,}
          \AttributeTok{precision =}\NormalTok{ metrics}\SpecialCharTok{$}\NormalTok{precision,}
          \AttributeTok{specificity =}\NormalTok{ metrics}\SpecialCharTok{$}\NormalTok{specificity,}
          \AttributeTok{balance\_accuracy =}\NormalTok{ metrics}\SpecialCharTok{$}\NormalTok{balance\_accuracy,}
          \AttributeTok{f1\_score =}\NormalTok{ metrics}\SpecialCharTok{$}\NormalTok{f1\_score}
\NormalTok{        )}
\NormalTok{      )}
\NormalTok{    \}}
\NormalTok{  \}}
  
  \FunctionTok{return}\NormalTok{ (cv\_raw)}
\NormalTok{\}}

\NormalTok{cv\_raw }\OtherTok{\textless{}{-}} \FunctionTok{cross\_validation}\NormalTok{(}\AttributeTok{df=}\NormalTok{training\_df, }\AttributeTok{simi\_matrix=}\NormalTok{simi\_matrix, }\AttributeTok{K\_folds=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# \# select the matrix for evaluating the knn model}
\CommentTok{\# training\_idx \textless{}{-} strtoi(row.names(training\_df))}
\CommentTok{\# train\_simi\_matrix \textless{}{-} simi\_matrix[training\_idx, training\_idx]}
\CommentTok{\# diag(train\_simi\_matrix) \textless{}{-} NA}
\CommentTok{\# }
\CommentTok{\# confusion\_matrix \textless{}{-} knn\_train(}
\CommentTok{\#   train=training\_df,}
\CommentTok{\#   simi\_matrix=train\_simi\_matrix,}
\CommentTok{\#   k=4}
\CommentTok{\# )}
\CommentTok{\# metrics = class\_metrics(confusion\_matrix)}
\CommentTok{\# }
\CommentTok{\# metrics}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyr)}

\CommentTok{\# long format: one row per (k, fold, metric)}
\NormalTok{cv\_long }\OtherTok{\textless{}{-}}\NormalTok{ cv\_raw }\SpecialCharTok{|\textgreater{}}
  \FunctionTok{pivot\_longer}\NormalTok{(}
    \AttributeTok{cols =} \FunctionTok{c}\NormalTok{(accuracy, recall, precision, specificity, balance\_accuracy, f1\_score),}
    \AttributeTok{names\_to =} \StringTok{"metric"}\NormalTok{,}
    \AttributeTok{values\_to =} \StringTok{"value"}
\NormalTok{  )}

\CommentTok{\# pdf("figs/cross\_f1.pdf", width = 10, height = 6)}
\CommentTok{\# draw boxplot}
\FunctionTok{boxplot}\NormalTok{(}
\NormalTok{  value }\SpecialCharTok{\textasciitilde{}}\NormalTok{ k,}
  \AttributeTok{data =}\NormalTok{ cv\_long[cv\_long}\SpecialCharTok{$}\NormalTok{metric }\SpecialCharTok{==} \StringTok{"f1\_score"}\NormalTok{, ],}
  \AttributeTok{ylab =} \StringTok{"F1 score"}\NormalTok{,}
  \AttributeTok{col =} \StringTok{"cyan"}\NormalTok{,}
  \AttributeTok{las =} \DecValTok{2}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{hERG_files/figure-latex/unnamed-chunk-45-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# dev.off()}
\end{Highlighting}
\end{Shaded}

\subsection{Evaluating the performance of the model on the test
set}\label{evaluating-the-performance-of-the-model-on-the-test-set}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# select the matrix for evaluating the knn model}
\NormalTok{subtest\_idx }\OtherTok{\textless{}{-}} \FunctionTok{strtoi}\NormalTok{(}\FunctionTok{row.names}\NormalTok{(test\_df))}
\NormalTok{training\_idx }\OtherTok{\textless{}{-}} \FunctionTok{strtoi}\NormalTok{(}\FunctionTok{row.names}\NormalTok{(training\_df))}

\NormalTok{test\_simi\_matrix }\OtherTok{\textless{}{-}}\NormalTok{ simi\_matrix[subtest\_idx, training\_idx]}

\NormalTok{confusion\_matrix }\OtherTok{\textless{}{-}} \FunctionTok{knn\_eval}\NormalTok{(}
  \AttributeTok{train=}\NormalTok{training\_df,}
  \AttributeTok{test =}\NormalTok{ test\_df,}
  \AttributeTok{simi\_matrix=}\NormalTok{test\_simi\_matrix,}
  \AttributeTok{k=}\DecValTok{4}
\NormalTok{)}
\NormalTok{metrics }\OtherTok{=} \FunctionTok{class\_metrics}\NormalTok{(confusion\_matrix)}

\NormalTok{metrics}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $accuracy
## [1] 0.9051095
## 
## $recall
## [1] 0.9178082
## 
## $precision
## [1] 0.9054054
## 
## $specificity
## [1] 0.890625
## 
## $balance_accuracy
## [1] 0.9178082
## 
## $f1_score
## [1] 0.9115646
\end{verbatim}

\end{document}
